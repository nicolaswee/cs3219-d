FROM python:3.7.7-stretch

WORKDIR /app

ADD . /app

#COPY .env ./.env

ARG DB_URL
ARG DRIVER
ARG DB_USERNAME
ARG DB_PASSWORD
ARG DB_PORT
ARG DB_NAME
ARG PASS_SECRET
ARG S3_BUCKET
ARG S3_BUCKET_LINK
ARG S3_KEY
ARG S3_SECRET_ACCESS_KEY
ARG MSK_BROKER_1
ARG MSK_BROKER_2
ARG REDIS
ARG FEED_QUEUE_TOPIC
ARG USER_MS
ARG CELEBRITY_QUEUE_TOPIC

ENV DB_URL=${DB_URL} \
    DRIVER=${DRIVER} \
    DB_USERNAME=${DB_USERNAME} \
    DB_PASSWORD=${DB_PASSWORD} \
    DB_PORT=${DB_PORT} \
    DB_NAME=${DB_NAME} \
    PASS_SECRET=${PASS_SECRET} \
    S3_BUCKET=${S3_BUCKET} \
    S3_BUCKET_LINK=${S3_BUCKET_LINK} \
    S3_KEY=${S3_KEY} \
    S3_SECRET_ACCESS_KEY=${S3_SECRET_ACCESS_KEY} \
    MSK_BROKER_1=${MSK_BROKER_1} \
    MSK_BROKER_2=${MSK_BROKER_2} \
    REDIS=${REDIS} \
    FEED_QUEUE_TOPIC=${FEED_QUEUE_TOPIC} \
    CELEBRITY_QUEUE_TOPIC=${CELEBRITY_QUEUE_TOPIC} \
    USER_MS=${USER_MS}

RUN pip install -r requirements.txt

EXPOSE 5001

CMD ["python", "app.py"]